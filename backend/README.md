## Настройка приложения для продакшн

* Приложение по умолчанию имеет конфиги для развёртки в prod режиме

## Настройка приложения для разработки

1. **Установите переменную окружения**  
   В файле `.env.local` добавьте строку:
   ```env
   APP_ENV=dev
   ```

2. **Укажите конфигурацию PHP для разработки**  
   Настройте `docker-compose.override.yml` по примеру `docker-compose.yml.dist`

3. **Настройте дебаггер**  
   Следуйте инструкции по настройке Xdebug для работы в режиме разработки.
   для вашей IDE (например, PHPStorm)

## Работа с контейнером

### Зайти в контейнер бэкенда

```bash
docker exec -it student-portal-backend bash
```

## Работа с миграциями

### Создание миграции

- Опишите доменную сущность.
- Настройте файл `doctrine.yaml`.
- Опишите маппинг сущности в `config/doctrine`.

### Создание миграции в контейнере

Для создания новой миграции выполните команду:

```bash
php bin/console make:migration
```

### Редактирование миграции

Миграции сохраняются в папке `migrations/`. При необходимости внесите изменения в созданный файл.

### Применение миграции

Для применения миграции выполните команду:

```bash
php bin/console doctrine:migrations:migrate
```

## Работа с api

### Генерация api для бэкенда

```bash
composer generate-api
```

## Авторизация

По умолчанию аккаунт овнера создаётся с такими данными:
Email: `owner@gmail.com`
Password: `12345Q`

## Настройка Xdebug для разработки

### Настройка Docker

1. Настройте `docker-compose.override.yml` по примеру `docker-compose.yml.dist`

### Настройка PhpStorm

1. **Убедитесь, что Xdebug настроен**

    - Перейдите в `PHP → Debug`.
    - Проверьте, что порт указан как `9003` (настроенный в `php.ini-development`).
    - Убедитесь, что включена опция `Break at first line in PHP scripts`.

2. `Настройте интерпретатор PHP`

    - Перейдите в `PHP`
    - Нажмите на `...` рядом с `CLI Interpreter` и добавьте новый интерпретатор:
        - Выберите `"From Docker"`
        - Укажите ваш сервис (например, `php`) и путь к PHP

3. **Настройка сервера**

    - Перейдите в `PHP → Servers`
    - Нажмите `+` и добавьте новый сервер:
        - Укажите:
            - `Name:` `StudentPortalBackendDocker` (например, `docker-compose.yml`)
            - `Host:` `localhost`
            - `Port:` `80`
        - Включите опцию `Use path mappings` и сопоставьте:
            - `/var/www/html` → `/app/`

4. **Настройте Debug Configuration**

    - В верхнем меню выберите `Run → Edit Configurations...`
    - Нажмите `+` и добавьте `PHP Remote Debug`
    - Укажите:
        - `Server:` <из предыдущего шага>
        - `IDE Key:` оставьте пустым или укажите `PHPSTORM`

### Настройка браузера

Убедитесь, что браузер посылает cookie с параметром `XDEBUG_SESSION=PHPSTORM`. Для этого:

- Установите расширение, например, `Xdebug Helper` для Chrome
- Настройте `IDE Key` как `PHPSTORM`